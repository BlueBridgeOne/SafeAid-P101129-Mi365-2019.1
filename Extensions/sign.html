<html>

<head>

</head>

<body>

    <canvas id="myCanvas" width="600" height="400" style="width:50%;border:1px solid #000000;">
    </canvas>
    <input id="sign" value="" />
    <script>
        var c = document.getElementById("myCanvas");
        var sign = document.getElementById("sign");
        var ctx = c.getContext("2d");
        var lastTime = new Date();
        var points = [],
            pressed = false;



        function getCanvasPos(e) {
            var ratioX=c.width/c.offsetWidth;
            var ratioY=c.height/c.offsetHeight;
            var offsetX = c.offsetTop;
            var offsetY = c.offsetLeft;
            return {
                x: parseInt((e.clientX - offsetX)*ratioX),
                y: parseInt((e.clientY - offsetY)*ratioY)
            };
        }

        function handleMouseDown(e) {
            var pos = getCanvasPos(e);
            points.push({
                s: true,
                x: pos.x,
                y: pos.y,
                w:2
            });
            pressed = true;
            lastTime = new Date();
        }

        function handleMouseUp(e) {
            var pos = getCanvasPos(e);
            pressed = false;
            sign.value=JSON.stringify(points);
        }

        function handleMouseOut(e) {
            var pos = getCanvasPos(e);
pressed=false;
sign.value=JSON.stringify(points);
        }

        function handleMouseMove(e) {
            var pos = getCanvasPos(e);

            if (pressed) {
                var newTime = new Date();
                var timeDiff = newTime.getTime() - lastTime.getTime();
                timeDiff=timeDiff*timeDiff*timeDiff; //spread out the values
                var lastPoint=points[points.length-1];
                if(pos.x==lastPoint.x&&pos.y==lastPoint.y){
                    return;
                }
                var dist=((lastPoint.x-pos.x)*(lastPoint.x-pos.x))+((lastPoint.y-pos.y)*(lastPoint.y-pos.y));
                var width = Math.max(.5, Math.min(5, (timeDiff / dist)/7));
                width=Math.round(width*10)/10;
                lastTime = newTime;
                
                if(lastPoint.w>width+2){
                    width=lastPoint.w-1;
                }else if(lastPoint.w<width-2){
                    width=lastPoint.w+1;
                }else if(lastPoint.w>width+1){
                    width=lastPoint.w-.5;
                }else if(lastPoint.w<width-1){
                    width=lastPoint.w+.5;
                }
                
                points.push({
                    x: pos.x,
                    y: pos.y,
                    w: width
                });
                ctx.beginPath();
                ctx.lineCap = "round";
                ctx.lineWidth = width;
                var c=120-(20*width);
                ctx.strokeStyle = "rgb("+c+","+c+","+c+")";
                
                ctx.moveTo(lastPoint.x, lastPoint.y);
                ctx.lineTo(pos.x, pos.y);
                ctx.stroke();
            }
        }


        c.onmousedown = function (e) {
            handleMouseDown(e);
        };
        c.onmousemove = function (e) {
            handleMouseMove(e);
        };
        c.onmouseup = function (e) {
            handleMouseUp(e);
        };
        c.onmouseout = function (e) {
            handleMouseOut(e);
        };
    </script>

</body>

</html>